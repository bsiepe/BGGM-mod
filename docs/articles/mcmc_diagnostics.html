<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MCMC Diagnostics • BGGMmod</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="MCMC Diagnostics">
<meta property="og:description" content="BGGMmod">
<meta property="og:image" content="https://donaldrwilliams.github.io/BGGMmod/reference/figures/hex.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@wdonald_1985">
<meta name="twitter:site" content="@wdonald_1985">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BGGMmod</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="../articles/installation.html">Troubleshoot</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/donaldRwilliams/BGGMmod/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>MCMC Diagnostics</h1>
                        <h4 class="author">Donny Williams</h4>
            
            <h4 class="date">5/20/2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/donaldRwilliams/BGGMmod/blob/master/vignettes/mcmc_diagnostics.Rmd"><code>vignettes/mcmc_diagnostics.Rmd</code></a></small>
      <div class="hidden name"><code>mcmc_diagnostics.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The algorithms in <strong>BGGMmod</strong> are based on Gibbs samplers. In the context of covariance matrix estimation, as opposed, to, say, hierarchical models, this allows for efficiently sampling the posterior distribution. Furthermore, in all samplers the empirical covariance matrix is used as the starting value which reduces the length of the burn-in (or warm-up). Still yet it is important to monitor convergence. See <a href="http://sbfnk.github.io/mfiidd/mcmc_diagnostics.html">here</a> for an introduction to MCMC diagnostics.</p>
<div id="r-packages" class="section level3">
<h3 class="hasAnchor">
<a href="#r-packages" class="anchor"></a>R packages</h3>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># need the developmental version</span>
<span class="kw">if</span> (!<span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"remotes"</span>)) {
  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)
}

<span class="co"># install from github</span>
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"donaldRwilliams/BGGMmod"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">BGGMmod</span>)</pre></body></html></div>
</div>
</div>
<div id="acf-plot" class="section level1">
<h1 class="hasAnchor">
<a href="#acf-plot" class="anchor"></a>ACF plot</h1>
<p>This first example includes an “acf” plot that looks at the auto correlation of the samples. In general, we do not want the samples to be strongly correlated or related to the previous samples (or lags <span class="math inline">\(k\)</span>). I am not sure there are general guidelines, but typically we do not want “auto correlation…for higher values of k, [because] this indicates a high degree of correlation between our samples and slow mixing” <a href="http://sbfnk.github.io/mfiidd/mcmc_diagnostics.html">source</a></p>
<p>Here is an example for ordinal data.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># data</span>
<span class="no">Y</span> <span class="kw">&lt;-</span> <span class="no">ptsd</span>[,<span class="fl">1</span>:<span class="fl">10</span>]

<span class="co"># fit model</span>
<span class="co"># + 1 makes first category a 1</span>
<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/estimate.html">estimate</a></span>(<span class="no">Y</span> + <span class="fl">1</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"ordinal"</span>)</pre></body></html></div>
<p>To check the convergence of a partial correlation, we need the parameter name. These are printed as follows</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/convergence.html">convergence</a></span>(<span class="no">fit</span>, <span class="kw">print_names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">#&gt;  [1] "B1--B2"         "B1--B3"         "B2--B3"         "B1--B4"         "B2--B4"         "B3--B4"         "B1--B5"        </span>
<span class="co">#&gt;  [8] "B2--B5"         "B3--B5"         "B4--B5"         "B1--C1"         "B2--C1"         "B3--C1"         "B4--C1"        </span>
<span class="co">#&gt; [15] "B5--C1"         "B1--C2"         "B2--C2"         "B3--C2"         "B4--C2"         "B5--C2"         "C1--C2"        </span>
<span class="co">#&gt; [22] "B1--D1"         "B2--D1"         "B3--D1"         "B4--D1"         "B5--D1"         "C1--D1"         "C2--D1"        </span>
<span class="co">#&gt; [29] "B1--D2"         "B2--D2"         "B3--D2"         "B4--D2"         "B5--D2"         "C1--D2"         "C2--D2"        </span>
<span class="co">#&gt; [36] "D1--D2"         "B1--D3"         "B2--D3"         "B3--D3"         "B4--D3"         "B5--D3"         "C1--D3"        </span>
<span class="co">#&gt; [43] "C2--D3"         "D1--D3"         "D2--D3"         "B1_(Intercept)" "B2_(Intercept)" "B3_(Intercept)" "B4_(Intercept)"</span>
<span class="co">#&gt; [50] "B5_(Intercept)" "C1_(Intercept)" "C2_(Intercept)" "D1_(Intercept)" "D2_(Intercept)" "D3_(Intercept)"</span></pre></body></html></div>
<p>Note the <code>(Intercept)</code> which reflect the fact that the ordinal approach is a multivariate probit model with only intercepts.</p>
<p>The next step is to make the plot</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/convergence.html">convergence</a></span>(<span class="no">fit</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="st">"B1--B2"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"acf"</span>)</pre></body></html></div>
<p><img src="../man/figures/acf_new2.png"></p>
<p>The argument <code>param</code> can take any number of parameters and a plot will be made for each (e.g.., <code>param = c("B1--B2", B1--B3)</code>). In this case, the auto correlations looks acceptable and actually really good (note the drop to zero). A problematic <code>acf</code> plot would have the black lines start at <code>1.0</code> and perhaps never go below <code>0.20</code>.</p>
<p>To make this clear, I simulated time series data taking the code from <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/arima.sim.html">here</a></p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># sim time series</span>
<span class="no">ts.sim</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html">arima.sim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">order</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>), <span class="kw">ar</span> <span class="kw">=</span> <span class="fl">0.7</span>), <span class="kw">n</span> <span class="kw">=</span> <span class="fl">200</span>)

<span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span>(<span class="no">ts.sim</span>)</pre></body></html></div>
<p><img src="../man/figures/acf_problem.png"></p>
<p>This would be considered problematic. If this occurs, one solution could be to thin the samples manually</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># extract samples</span>
<span class="no">samps</span> <span class="kw">&lt;-</span> <span class="no">fit</span>$<span class="no">post_samp</span>$<span class="no">pcors</span>

<span class="co"># iterations</span>
<span class="no">iter</span> <span class="kw">&lt;-</span> <span class="no">fit</span>$<span class="no">iter</span>

<span class="co"># thinning interval </span>
<span class="no">thin</span> <span class="kw">&lt;-</span>  <span class="fl">5</span>

<span class="co"># save every 5th (add 50 which is the burnin)</span>
<span class="no">new_iter</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="kw">to</span> <span class="kw">=</span> <span class="no">iter</span> + <span class="fl">50</span> , <span class="kw">by</span> <span class="kw">=</span> <span class="no">thin</span>))

<span class="co"># replace (add 50 which is the burnin)</span>
<span class="no">fit</span>$<span class="no">post_samp</span>$<span class="no">pcors</span> <span class="kw">&lt;-</span> <span class="no">samps</span>[,,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="kw">to</span> <span class="kw">=</span> <span class="no">iter</span> + <span class="fl">50</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="no">thin</span>)]

<span class="co"># replace iter</span>
<span class="no">fit</span>$<span class="no">iter</span> <span class="kw">&lt;-</span> <span class="no">new_iter</span> - <span class="fl">50</span>

<span class="co"># check thinned</span>
<span class="fu"><a href="../reference/convergence.html">convergence</a></span>(<span class="no">fit</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="st">"B1--B2"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"acf"</span>)</pre></body></html></div>
<p>or perhaps just running the model for more iterations (e.g., increasing <code>iter</code> in <code>estimate</code>). The above is quite convoluted but note convergence should not typically be an issue. And it might come in handy to know that the samples can be replaced and the other functions in <strong>BGGMmod</strong> will still work with the object <code>fit</code>.</p>
</div>
<div id="trace-plot" class="section level1">
<h1 class="hasAnchor">
<a href="#trace-plot" class="anchor"></a>Trace plot</h1>
<p>The next example is a trace plot. Here we are looking for good “mixing”.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/convergence.html">convergence</a></span>(<span class="no">fit</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="st">"B1--B2"</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"trace"</span>)</pre></body></html></div>
<p><img src="../man/figures/trace.png"></p>
<p>Admittedly the term “mixing” is vague. But in general the plot should look like this example, where there is no place that the chain is “stuck”. See <a href="https://stats.stackexchange.com/questions/311151/evaluation-of-mcmc-samples">here</a> for problematic trace plots.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Donald Williams, Joris Mulder.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
